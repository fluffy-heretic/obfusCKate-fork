#Events handling the flagging of characters the player meets

namespace = acquaintance

#Make an acquaintance through sway

acquaintance.1001 = {
	type = character_event
	hidden = yes 
	trigger = {
				OR = {scope:owner = {is_ai = no}
				scope:target = {is_ai = no}}
				scope:target = { 
				NOT = {has_relation_to = scope:owner} 
				OR = {
						opinion = {
						target = scope:owner
						value >= 90 
						}
						has_opinion_modifier = {
							target = scope:owner
							modifier = scheme_sway_opinion
							value >= 35
						}
						has_opinion_modifier = {
							target = scope:owner
							modifier = friendliness_opinion
						}
						has_opinion_modifier = {
							target = scope:owner
							modifier = grateful_opinion
						}
						has_opinion_modifier = {
							target = scope:owner
							modifier = angry_opinion
						}
				}
			}
		}

	immediate = {
		if = {
		limit = {scope:target = {
					is_ai = yes
					OR = {opinion = {
						target = scope:owner
						value >= 90 
						}
						has_opinion_modifier = {
							target = scope:owner
							modifier = scheme_sway_opinion
							value >= 90
						}}}}
		scope:target = {
				character_deception_effect = yes
				add_character_flag = {
				flag = partially_spied
				years = 7
					}
			add_character_flag = {
				flag = partially_spied_2
				years = 4
					}
			add_character_flag = {
				flag = partially_spied_3
				years = 2
					}
				}
			}
		else_if = {
		limit = {scope:target = {is_ai = yes}}
		scope:target = {
				character_barely_known_effect = yes
				}
			}
		else_if = {
		limit = {scope:owner = {is_ai = yes}}
		scope:owner = {
			character_barely_known_effect = yes
				}
			}
		}
}
acquaintance.1002 = {
	type = character_event
	hidden = yes 
	trigger = {
				OR = {scope:owner = {is_ai = no}
				scope:target = {is_ai = no}}
				scope:target = { 
				NOT = {has_relation_to = scope:owner} 
				OR = { 
						opinion = {
						target = scope:owner
						value >= 90
						}
						has_opinion_modifier = {
							target = scope:owner
							modifier = scheme_sway_opinion
							value >= 35
						}
						has_opinion_modifier = {
							target = scope:owner
							modifier = friendliness_opinion
						}
						has_opinion_modifier = {
							target = scope:owner
							modifier = grateful_opinion
						}
						has_opinion_modifier = {
							target = scope:owner
							modifier = angry_opinion
						}
				}
			}
		}

	immediate = {
		if = {
		limit = {scope:target = {
					is_ai = yes
					OR = {opinion = {
						target = scope:owner
						value >= 90 
						}
						has_opinion_modifier = {
							target = scope:owner
							modifier = scheme_sway_opinion
							value >= 90
						}}}}
		scope:target = {
				character_deception_effect = yes
				add_character_flag = {
				flag = partially_spied
				years = 7
					}
			add_character_flag = {
				flag = partially_spied_2
				years = 4
					}
			add_character_flag = {
				flag = partially_spied_3
				years = 2
					}
				}
			}
		else_if = {
		limit = {scope:target = {is_ai = yes}}
		scope:target = {
				add_character_flag = {
				flag = partially_spied
				years = 5
					}
			add_character_flag = {
				flag = partially_spied_2
				years = 2
					}
				}
			}
		else_if = {
		limit = {scope:owner = {is_ai = yes}}
		scope:owner = {
			character_barely_known_effect = yes
				}
			}
		}
}

acquaintance.1003 = {
	type = character_event
	hidden = yes 
	trigger = {
				OR = {scope:owner = {is_ai = no}
				scope:target = {is_ai = no}}
				scope:target = { 
				NOT = {has_relation_to = scope:owner}
				OR = {
				scope:target = { 
				has_opinion_modifier = {
					target = scope:owner
					modifier = scheme_sway_opinion
					value >= 1
							}
						}
						
				AND = {	scope:target = {is_ai = no}
						scope:scheme = {
						has_variable = had_event_sway_ongoing_1001 }}
				AND = {	scope:target = {is_ai = no}
						scope:scheme = {
						has_variable = had_event_sway_ongoing_1002 }}
				AND = {	scope:target = {is_ai = no}
						scope:scheme = {
						has_variable = had_event_sway_ongoing_1005 }}
				AND = {	scope:target = {is_ai = no}
						scope:scheme = {
						has_variable = had_event_sway_ongoing_1006 }}
				scope:scheme = {
						has_variable = had_event_sway_ongoing_5001 }
				scope:scheme = {
						has_variable = had_event_sway_ongoing_5011 }
					}
				}
			}

	immediate = {
		if = {
		limit = {scope:target = {is_ai = yes}}
		scope:target = {
				character_met_effect = yes
				}
			}
		else_if = {
		limit = {scope:owner = {is_ai = yes}}
		scope:owner = {
			character_met_effect = yes
				}
			}
		}
}


####BEFRIEND####
####Make an acquaintance through befriend

acquaintance.2001 = {
	type = character_event
	hidden = yes 
		trigger = { 
				exists = scope:scheme
				OR = {scope:owner = {is_ai = no}
				scope:target = {is_ai = no}}
				}
immediate = {
		if = {
		limit = {
				scope:target = {
					is_ai = yes
				befriend_had_interaction = yes}}
		scope:target = {
				character_deception_effect = yes
				character_known_effect = yes
				}
			}
		else_if = {
		limit = {
				scope:owner = {
					is_ai = yes
				befriend_had_interaction = yes}}
		scope:owner = {
			character_deception_effect = yes
			character_known_effect = yes
				}
			}
		else_if = {
		limit = {
				scope:target = {
				is_ai = yes
				NOT = {has_character_flag = partially_spied_2}
				befriend_had_contact = yes}}
		scope:target = {
				character_barely_known_effect = yes
				}
			}
		else_if = {
		limit = {
				scope:owner = {is_ai = yes
				NOT = {has_character_flag = partially_spied_3}
				befriend_had_contact = yes}}
		scope:owner = {
			character_barely_known_effect = yes
				}
			}
		else_if = {
		limit = {
				scope:target = {
				is_ai = yes
				NOT = {has_character_flag = partially_spied_2}
				befriend_has_met = yes}}
		scope:target = {
				character_met_effect = yes
				}
			}
		else_if = {
		limit = {
				scope:owner = {
				is_ai = yes
				NOT = {has_character_flag = partially_spied_2}
				befriend_has_met = yes}}
		scope:owner = {
			character_met_effect = yes
				}
			}
		}
}

#### SCHEME OUTCOMES - BEFRIEND 
acquaintance.2002 = {
	type = character_event
	hidden = yes 
		trigger = { 
				OR = {scope:owner = {is_ai = no}
				scope:target = {is_ai = no}}
				}
immediate = {
		if = {
		limit = {
		scope:target = {
					is_ai = yes
				NOT = {has_character_flag = partially_spied_2}}}
		scope:target = {
				character_met_effect = yes
				}
			}
		else_if = {
		limit = {
		scope:owner = {
					is_ai = yes
				NOT = {has_character_flag = partially_spied_2}}}
		scope:owner = {
				character_met_effect = yes
				}
		}
	}
}
####SEDUCTION####
####Make an acquaintance through seduce

acquaintance.2003 = {
	type = character_event
	hidden = yes 
		trigger = { 
				exists = scope:scheme
				OR = {scope:owner = {is_ai = no}
				scope:target = {is_ai = no}}
				}
immediate = {
		if = {
		limit = {
				scope:target = {
					is_ai = yes
				has_opinion_modifier = {
					target = scope:owner
					modifier = romance_opinion}}
				scope:scheme = {has_scheme_modifier = seduce_success_2_modifier}}
		scope:target = {
				character_deception_effect = yes
				character_known_effect = yes
				}
			}
		else_if = {
		limit = {
				scope:owner = {
					is_ai = yes
				has_opinion_modifier = {
					target = scope:target
					modifier = romance_opinion}}}
		scope:owner = {
			character_deception_effect = yes
				character_known_effect = yes
				}
			}
		else_if = {
		limit = {
				scope:target = {
				is_ai = yes
				NOT = {has_character_flag = partially_spied_3}}
				scope:scheme = {has_scheme_modifier = seduce_success_2_modifier}}
		scope:target = {
				character_barely_known_effect = yes
				}
			}
		else_if = {
		limit = {
				scope:owner = {is_ai = yes
				NOT = {has_character_flag = partially_spied_3}}
				scope:scheme = {has_scheme_modifier = seduce_success_2_modifier}}
		scope:owner = {
			character_barely_known_effect = yes
				}
			}
		else_if = {
		limit = {
				scope:target = {
				is_ai = yes
				NOT = {has_character_flag = partially_spied_2}}
				OR = {
				scope:scheme = {has_scheme_modifier = seduce_success_1_modifier}
				scope:scheme = {scheme_progress >= 6}}}
		scope:target = {
				character_met_effect = yes
				}
			}
		else_if = {
		limit = {
				scope:owner = {
				is_ai = yes
				NOT = {has_character_flag = partially_spied_2}}
				OR = {
				scope:scheme = {has_scheme_modifier = seduce_success_1_modifier}
				scope:scheme = {scheme_progress >= 6}}}
		scope:owner = {
			character_met_effect = yes
				}
			}
		}
}

#### SCHEME OUTCOMES  SEDUCE
acquaintance.2004 = {
	type = character_event
	hidden = yes 
		trigger = { 
				OR = {scope:owner = {is_ai = no}
				scope:target = {is_ai = no}}
				}
immediate = {
		if = {
		limit = {
		scope:target = {
					is_ai = yes
			scope:scheme = {
			OR = {
					has_scheme_modifier = seduce_failure_2_modifier
					has_variable = declined_seduce_milestone_2_event
						}
					}
				}
			}
		scope:target = {
				character_barely_known_effect = yes
				}
			}
		else_if = {
		limit = {
		scope:owner = {
					is_ai = yes
				scope:scheme = {
			OR = {
					has_scheme_modifier = seduce_failure_2_modifier
					has_variable = declined_seduce_milestone_2_event
						}
					}
				}
			}
		scope:owner = {
				character_barely_known_effect = yes
				}
		}
	}
}

#####ROMANCE
#Make an acquaintance through romance
acquaintance.2005 = {
	type = character_event
	hidden = yes 
		trigger = { 
				exists = scope:scheme
				OR = {scope:owner = {is_ai = no}
				scope:target = {is_ai = no}}
				}
immediate = {
		if = {
		limit = {
				scope:target = {
					is_ai = yes}
			
		scope:scheme = {exists = var:court_milestone_event
							var:court_milestone_event >= 3}}
		scope:target = {
				character_deception_effect = yes
				character_known_effect = yes
				}
			}
		else_if = {
		limit = {
				scope:owner = {
					is_ai = yes}
			scope:scheme = {exists = var:court_milestone_event
							var:court_milestone_event >= 3}}
		scope:owner = {
			character_deception_effect = yes
				character_known_effect = yes
				}
			}
		else_if = {
		limit = {
				scope:target = {
				is_ai = yes
				NOT = {has_character_flag = partially_spied_3}}
		scope:scheme = {exists = var:court_milestone_event
							var:court_milestone_event > 1}}
		scope:target = {
				character_barely_known_effect = yes
				}
			}
		else_if = {
		limit = {
				scope:owner = {is_ai = yes
				NOT = {has_character_flag = partially_spied_3}}
		scope:scheme = {exists = var:court_milestone_event
							var:court_milestone_event > 1}}
		scope:owner = {
			character_barely_known_effect = yes
				}
			}
		else_if = {
		limit = {
				scope:target = {
				is_ai = yes
				NOT = {has_character_flag = partially_spied_2}}}
		scope:target = {
				character_met_effect = yes
				}
			}
		else_if = {
		limit = {
				scope:owner = {
				is_ai = yes
				NOT = {has_character_flag = partially_spied_2}}}
		scope:owner = {
			character_met_effect = yes
				}
			}
		}
}

###ACTIVITIES - FEAST - HUNT - PLAYDATE

#FLAG PARTICIPANTS IN ACTIVITY

acquaintance.3000 = { #All see each other for the first time
	type = character_event
	hidden = yes
	
	trigger = { root = {is_ai = no}}
	immediate = {
		if = {
			limit = {
				root = {is_adult = yes}}
		scope:activity = {
				every_attending_character = {
				limit = {
				NOT = {this = root}
				NOT = {has_relation_to = root}}
				add_character_flag = {
				flag = partially_spied
				months = 18
					}
				}
				every_attending_character = {
				limit = {
				NOT = {this = root}
				OR = {
				has_trait = albino
				has_trait = giant
				has_trait = dwarf
				has_trait = hunchbacked
				has_trait = beauty_bad_3
				has_trait = one_legged
				has_trait = disfigured
				has_trait = one_eyed
				has_trait = scaly
				ai_sociability > 75
				}
				NOT = {has_relation_to = root}}
				add_character_flag = {
				flag = partially_spied
				years = 3
					}
				}
				every_attending_character = {
				limit = {
				NOT = {this = root}
				root = {is_attracted_to_gender_of = prev}
				AND = {
				OR = {has_trait = beauty_good
				has_trait = physique_good}
					}
				NOT = {has_relation_to = root}}
				add_character_flag = {
				flag = partially_spied
				years = 3
					}
				}
			}
		}
		if = {
			limit = {
				root = {is_adult = no}}
		scope:activity = {
				every_attending_character = {
				limit = {
				NOT = {this = root}
				NOT = {has_relation_to = root}}
				add_character_flag = {
				flag = partially_spied
				months = 18
					}
				}
			}
		}
		if = {
			limit = {
				root = {is_adult = no
				NOT = {has_trait = pensive}}}
		scope:activity = {
				every_attending_character = {
				limit = {
				NOT = {has_trait = pensive}
				has_trait = curious
				NOT = {this = root}
				NOT = {has_relation_to = root}}
				character_met_effect = yes
				}
			}
		}
		if = {
			limit = {
				root = {is_adult = no
				has_trait = curious
				NOT = {has_trait = pensive}}}
		scope:activity = {
				every_attending_character = {
				limit = {
				NOT = {has_trait = pensive}
				NOT = {this = root}
				NOT = {has_relation_to = root}}
				character_met_effect = yes
				}
			}
		}
		if = {  ##It's only natural that an honorary guest is properly introduced so you get a deeper knowledge
			limit = {
				exists = involved_activity.special_guest:honorary_guest
			}
			involved_activity.special_guest:honorary_guest = { save_scope_as = honorary_guest }
		}
		else_if = {  ##It's only natural that an honorary guest is properly introduced so you get a deeper knowledge
			limit = {
				exists = involved_activity.special_guest:honorary_guest_regular
			}
			involved_activity.special_guest:honorary_guest_regular = { save_scope_as = honorary_guest  }
		}
		scope:honorary_guest = {
		character_barely_known_effect = yes
		}
	}
}

##The host is a sociable person and so are you or you are the host and the guest is sociable
acquaintance.3001 = {
	type = character_event
	hidden = yes
	
	trigger = {
	root = {is_ai = no
			ai_sociability >= 70
			NOT = {has_trait = shy}}
	scope:activity = {
			activity_host = root}}

	immediate = {
		scope:activity = {
				every_attending_character = {
				limit = {
				ai_sociability >= 70
				NOT = {has_trait = shy}
				NOT = {this = root}
				NOT = {has_relation_to = root}}
				character_barely_known_effect = yes
					}
				}
	}
}

acquaintance.3002 = {
	type = character_event
	hidden = yes
	
	trigger = {
	root = {is_ai = no
			ai_sociability >= 70
			NOT = {has_trait = shy}}
	scope:activity = {
			activity_host ={
				NOT = {this = root}
				ai_sociability >= 70
			NOT = {has_trait = shy}}}}

	immediate = {
		scope:activity = {
			activity_host ={
				character_barely_known_effect = yes
					}
				}
	}
}

acquaintance.3003 = {
	type = character_event
	hidden = yes 
		trigger = { 
				root = {is_ai = no}
	
			}
			
immediate = {
		scope:activity = {
			every_attending_character = {
					limit = {
					is_ai = yes
					feast_had_interaction = yes
					}
				add_to_temporary_list = feast_interactions	
				}
			}
		every_in_list = {
			limit = {
			is_alive = yes
						NOT = {this = root}}
			list = feast_interactions
			character_deception_effect = yes
				character_known_effect = yes
				}
		scope:activity = {
				every_attending_character = {
					limit = {
					is_ai = yes
					feast_had_contact = yes
					}
				add_to_temporary_list = feast_contacts	
				}
			}
		every_in_list = {
			limit = {
			is_alive = yes
						NOT = {this = root}}
			list = feast_contacts
			character_barely_known_effect = yes
				}
		scope:activity = {
				every_attending_character = {
					limit = {
					is_ai = yes
					feast_slight_contact = yes
					}
				add_to_temporary_list = feast_met_slightly	
				}
			}
		every_in_list = {
			limit = {
			is_alive = yes
						NOT = {this = root}}
			list = feast_met_slightly	
			character_met_effect = yes
				}
		}
}

acquaintance.3004 = {
	type = character_event
	hidden = yes 
		trigger = { 
				root = {is_ai = no}
	
			}
			
immediate = {
		scope:activity = {
			every_attending_character = {
					limit = {
					is_ai = yes
				OR = {feast_had_interaction = yes
					wedding_had_interaction = yes}
					}
				add_to_temporary_list = wedding_interactions	
				}
			}
		every_in_list = {
			limit = {
			is_alive = yes
						NOT = {this = root}}
			list = wedding_interactions
			character_deception_effect = yes
				character_known_effect = yes
				}
		scope:activity = {
				every_attending_character = {
					limit = {
					is_ai = yes
				OR = {feast_had_contact = yes
					wedding_had_contact = yes}
					}
				add_to_temporary_list = wedding_contacts	
				}
			}
		every_in_list = {
			limit = {
			is_alive = yes
						NOT = {this = root}}
			list = wedding_contacts
			character_barely_known_effect = yes
				}
		scope:activity = {
				every_attending_character = {
					limit = {
					is_ai = yes
				OR = {feast_slight_contact = yes
					wedding_slight_contact = yes}
					}
				add_to_temporary_list = wedding_met_slightly	
				}
			}
		every_in_list = {
			limit = {
			is_alive = yes
						NOT = {this = root}}
			list = wedding_met_slightly	
			character_met_effect = yes
				}
		}
}



##########################
# Trying to seduce a sexaully incompatible character
# Seduction_rejection
# 8000
##########################

#hard reject
#Close family hard reject 
acquaintance.8000 = {
	type = character_event
	title = seduce_outcome.8101.t
	desc = seduce_outcome.8101.desc
	
	theme = seduce_scheme
	left_portrait = scope:owner

	trigger = {
		exists = scope:scheme
		scope:owner = { is_alive = yes }
	}

	immediate = {
		hidden_effect = {
			#For clearer and more controllable ai outcomes, we determine the outcome here:

			#HARD REJECT
			if = { # Guaranteed rejection
				limit = { NOT = { is_attracted_to_gender_of = scope:owner  } }
				save_scope_value_as = {
					name = incest_outcome
					value = flag:reject
				}
			}

			#SPECIFY REJECTION TYPE
			if = {
				limit = {
					exists = scope:incest_outcome
					scope:incest_outcome = flag:reject
				}

				#What kind of reject?
				random_list = {
					30 = { #Reveal
						opinion_modifier = {
							opinion_target = scope:owner
							multiplier = -0.25
						}
						ai_value_modifier = {
							ai_boldness = 0.5
							ai_compassion = -0.5
							ai_vengefulness = 0.5
						}
						ai_boldness_target_modifier = { VALUE = 100 }
						ai_vengefulness_target_modifier = { VALUE = 100 }
						min = 1 # To ensure 'incest_outcome' is never left unset.

						save_scope_value_as = {
							name = incest_outcome
							value = flag:reject_reveal
						}
					}
					70 = { #Silent reject
						opinion_modifier = {
							opinion_target = scope:owner
							multiplier = 0.25
						}
						modifier = { #Less harsh on child
							is_parent_of = scope:owner
							add = 30
						}
						modifier = { #Less harsh if you stand to inherit
							is_heir_of = scope:owner
							add = 30
						}
						ai_value_modifier = {
							ai_boldness = -0.5
							ai_compassion = 0.5
							ai_vengefulness = -0.5
						}
						ai_greed_target_modifier = { VALUE = 75 }
						min = 1 # To ensure 'incest_outcome' is never left unset.

						save_scope_value_as = {
							name = incest_outcome
							value = flag:reject_no_reveal
						}
					}
				}
			}
		}
	}

	option = { #Leave me be!!
		name = seduce_outcome.8101.a
		trigger = {
			trigger_if = {
				limit = {
					OR = {
		           	 	faith = { has_doctrine = doctrine_consanguinity_unrestricted }
		            	scope:owner = { has_perk = graceful_recovery_perk }
				    }
			    }
			    is_ai = no
			}
		}
		
		reverse_add_opinion = {
			target = scope:owner
			modifier = refusal_opinion
			opinion = -20
		}

		seduction_block_character_effect = { CHARACTER = scope:owner }

		scope:owner = {
			trigger_event = seduce_outcome.8102
		}
		
		ai_chance = {
			base = 0
			modifier = {
				add = 100
				scope:incest_outcome = flag:reject_no_reveal
			}
		}
	}

	option = { #I will tell everyone about this!
		name = seduce_outcome.8101.c
		trigger = {
			trigger_if = {
				limit = {
		            scope:owner = { has_perk = graceful_recovery_perk }
			    }
			    is_ai = no
			}
			NOT = {
				faith = { has_doctrine = doctrine_consanguinity_unrestricted }
			}
		}

		reverse_add_opinion = {
			target = scope:owner
			modifier = angry_opinion
			opinion = -35
		}

		seduction_block_character_effect = { CHARACTER = scope:owner }

		#Reveals incest (and sodomy/adultery)
		show_as_tooltip = {
			scope:owner = {
				seduce_outcome_publicised_attempted_crimes_or_nothing_effect = {
					TARGET = scope:target
					OWNER = scope:owner
				}
			}
		}

		scope:owner = {
			trigger_event = seduce_outcome.8103
		}

		ai_chance = {
			base = 0
			modifier = {
				add = 100
				scope:incest_outcome = flag:reject_reveal
			}
		}
	}

	option = { #Sin be damned, lets go!
		name = seduce_outcome.8101.b
		custom_tooltip = seduce_outcome.8101.b.tt

		ai_chance = {
			base = 0
			modifier = {
				add = 100
				scope:incest_outcome = flag:accept
			}
		}
	}
}

acquaintance.8001 = {
	type = character_event
	title = acquaintance.8001.t
	desc = acquaintance.8001.desc

	
	theme = seduce_scheme
	left_portrait = scope:owner

	trigger = {
		exists = scope:scheme
		scope:owner = { is_alive = yes }
	}

	immediate = {
		scope:target = {character_met_effect = yes}
		hidden_effect = {
			#For clearer and more controllable ai outcomes, we determine the outcome here:

			#HARD REJECT
			if = { # Guaranteed rejection
				limit = { NOT = { is_attracted_to_gender_of = scope:owner  } }
				save_scope_value_as = {
					name = reject_outcome
					value = flag:reject
				}
			}
			else = { #Randomization
				random = {
					chance = 100
					incest_acceptance_modifier = { #A factor between 1 and 0
						TARGET = scope:target
						SEDUCER = scope:owner
					}
					save_scope_value_as = {
						name = reject_outcome
						value = flag:accept
					}					
				}	
				if = {
					limit = { NOT = { exists = scope:reject_outcome } }
					save_scope_value_as = {
						name = reject_outcome
						value = flag:reject
					}
				}
			}

			#SPECIFY REJECTION TYPE
			if = {
				limit = {
					exists = scope:reject_outcome
					scope:reject_outcome = flag:reject
				}

				#What kind of reject?
				random_list = {
					30 = { #Reveal
						opinion_modifier = {
							opinion_target = scope:owner
							multiplier = -0.25
						}
						ai_value_modifier = {
							ai_boldness = 0.5
							ai_compassion = -0.5
							ai_vengefulness = 0.5
						}
						ai_boldness_target_modifier = { VALUE = 100 }
						ai_vengefulness_target_modifier = { VALUE = 100 }
						min = 1 # To ensure 'reject_outcome' is never left unset.

						save_scope_value_as = {
							name = reject_outcome
							value = flag:reject_reveal
						}
					}
					70 = { #Silent reject
						opinion_modifier = {
							opinion_target = scope:owner
							multiplier = 0.25
						}
						modifier = { #Less harsh if you stand to inherit
							is_heir_of = scope:owner
							add = 30
						}
						ai_value_modifier = {
							ai_boldness = -0.5
							ai_compassion = 0.5
							ai_vengefulness = -0.5
						}
						ai_greed_target_modifier = { VALUE = 75 }
						min = 1 # To ensure 'reject_outcome' is never left unset.

						save_scope_value_as = {
							name = reject_outcome
							value = flag:reject_no_reveal
						}
					}
				}
			}
		}
	}

	option = { #Stop it!
		name = acquaintance.8001.a
		trigger = {
			trigger_if = {
				limit = {
		            	scope:owner = { has_perk = graceful_recovery_perk }
			    }
			    is_ai = no
			}
		}
		
		reverse_add_opinion = {
			target = scope:owner
			modifier = refusal_opinion
			opinion = -20
		}

		seduction_block_character_effect = { CHARACTER = scope:owner }

		scope:owner = {
		#Sodomy
		give_homosexual_secret_or_nothing_with_target_effect = { CHARACTER = scope:target }
			trigger_event = acquaintance.8002
		}
		
		ai_chance = {
			base = 0
			modifier = {
				add = 100
				scope:reject_outcome = flag:reject_no_reveal
			}
		}
	}

	option = { #everyone will know about this!
		name = acquaintance.8001.c
		trigger = {
			trigger_if = {
				limit = {
		            scope:owner = { has_perk = graceful_recovery_perk }
			    }
			    is_ai = no
			}
		}

		reverse_add_opinion = {
			target = scope:owner
			modifier = angry_opinion
			opinion = -35
		}

		seduction_block_character_effect = { CHARACTER = scope:owner }

		#Reveals incest (and sodomy/adultery)
		show_as_tooltip = {
			scope:owner = {
			
				seduce_outcome_publicised_attempted_crimes_or_nothing_effect = {
					TARGET = scope:target
					OWNER = scope:owner
				}
			}
		}

		scope:owner = {
			trigger_event = acquaintance.8003
		}

		ai_chance = {
			base = 0
			modifier = {
				add = 100
				scope:reject_outcome = flag:reject_reveal
			}
		}
	}

	option = { #Sin be damned, lets go!
		name = acquaintance.8001.b
		custom_tooltip = acquaintance.8001.b.tt

		ai_chance = {
			base = 0
			modifier = {
				add = 100
				scope:reject_outcome = flag:accept
			}
		}
	}
}


# Rejected
acquaintance.8002 = {
	type = character_event
	title = acquaintance.8002.t
	desc = acquaintance.8002.desc
	
	theme = seduce_scheme
	override_background = { reference = garden }
	left_portrait = {
		character = scope:owner
		animation = shame
	}
	right_portrait = {
		character = scope:target
		animation = anger
	}
		
	widget = {
		gui = "event_window_widget_scheme"
		container = "custom_widgets_container"
	}

	immediate = {
		scope:target = {
			if = {
				limit = { root = { is_ai = no }	}
				assign_quirk_effect = yes
			}
		}
	}

	option = {
		name = acquaintance.8002.a
		custom_tooltip = seduce_outcome.blocked_from_seduction

		scope:target = { seduction_block_character_effect = { CHARACTER = scope:owner } }

		if = {
			limit = { exists = scope:scheme }
			scope:scheme = {
				end_scheme = yes
			}
		}
		scope:owner = {give_homosexual_secret_or_nothing_with_target_effect = { CHARACTER = scope:target }}
		
		#Stress
		stress_impact = {
			lustful = medium_stress_impact_gain
		}
		reverse_add_opinion = {
			target = scope:target
			modifier = respect_opinion
			opinion = -25
		}
	}
}

#Rejected and revealed!
acquaintance.8003 = {
	type = character_event
	title = acquaintance.8003.t
	desc = acquaintance.8003.desc
	
	theme = seduce_scheme
	override_background = { reference = market }
	left_portrait = {
		character = scope:owner
		animation = beg
	}
	right_portrait = {
		character = scope:target
		animation = rage
	}
	widget = {
		gui = "event_window_widget_scheme"
		container = "custom_widgets_container"
	}

	immediate = {
		scope:target = {
			assign_quirk_effect = yes
		}
	}

	option = {
		name = acquaintance.8003.a
		custom_tooltip = seduce_outcome.blocked_from_seduction
		scope:owner = {
		give_homosexual_secret_or_nothing_with_target_effect = { CHARACTER = scope:target }
		seduce_outcome_publicised_attempted_crimes_or_nothing_effect = {
			TARGET = scope:target
			OWNER = scope:owner
		}}

		scope:target = { seduction_block_character_effect = { CHARACTER = scope:owner } }

		if = {
			limit = { exists = scope:scheme }
			scope:scheme = {
				end_scheme = yes
			}
		}
		#Stress
		stress_impact = {
			lustful = medium_stress_impact_gain
			zealous = medium_stress_impact_gain
		}

		reverse_add_opinion = {
			target = scope:target
			modifier = respect_opinion
			opinion = -40
		}
	}
}
acquaintance.8004 = {
	type = character_event
	title = acquaintance.8001.t
	desc = acquaintance.8001.desc

	
	theme = seduce_scheme
	left_portrait = scope:owner

	trigger = {
		exists = scope:scheme
		scope:owner = { is_alive = yes }
	}

	immediate = {
		hidden_effect = {
			#For clearer and more controllable ai outcomes, we determine the outcome here:

			#HARD REJECT
			if = { # Guaranteed rejection
				limit = { NOT = { is_attracted_to_gender_of = scope:owner  } }
				save_scope_value_as = {
					name = reject_outcome
					value = flag:reject
				}
			}
		}
	}

	option = { #Stop it!
		name = acquaintance.8001.a
		
		reverse_add_opinion = {
			target = scope:owner
			modifier = refusal_opinion
			opinion = -20
		}

		seduction_block_character_effect = { CHARACTER = scope:owner }

		scope:owner = {
			trigger_event = acquaintance.8005
		}
		
		ai_chance = {
			base = 0
			modifier = {
				add = 100
				scope:reject_outcome = flag:reject_no_reveal
			}
		}
	}
}

# Rejected by spouse
acquaintance.8005 = {
	type = character_event
	title = acquaintance.8005.t
	desc = acquaintance.8005.desc
	
	theme = seduce_scheme
	left_portrait = {
		character = scope:owner
		animation = sadness
	}
	right_portrait = {
		character = scope:target
		animation = disgust
	}
		
	widget = {
		gui = "event_window_widget_scheme"
		container = "custom_widgets_container"
	}

	immediate = {
		scope:target = {
			if = {
				limit = { root = { is_ai = no }	}
				assign_quirk_effect = yes
			}
		}
	}

	option = {
		name = acquaintance.8005.a
		custom_tooltip = seduce_outcome.blocked_from_seduction

		scope:target = { seduction_block_character_effect = { CHARACTER = scope:owner } }
		#Stress
		stress_impact = {
			lustful = medium_stress_impact_gain
		}
		if = {
			limit = { exists = scope:scheme }
			scope:scheme = {
				end_scheme = yes
			}
		}

	}
}
#Nice reject
acquaintance.8006 = { #by Mathilda Bjarnehed & Petter Vilberg
	type = character_event
	title = seduce_outcome.0003.t
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { exists = scope:scheme_successful }
				desc = seduce_outcome.0003.success.desc
			}
			desc = seduce_outcome.0003.failure.desc
		}
	}
	
	theme = seduce_scheme
	override_background = { reference = market }
	left_portrait = {
		character = scope:owner
		animation = sadness
	}
	right_portrait = {
		character = scope:target
		animation = dismissal
	}
	
	#Failure: let down easy
	option = {
		name = seduce_outcome.0003.c

		save_scope_value_as = {
			name = target_chose_nice_reject
			value = yes
		}
		show_as_tooltip = {
			scope:scheme = {
				end_scheme = yes
			}
		}
		scope:owner = {
			trigger_event = {
				id = seduce_outcome.4001 #Nice reject
				days = 1
			}
		}

		#Stress
		stress_impact = {
			lustful = medium_stress_impact_gain
		}
		if = { #Hard to say no to someone who is seductive
			limit = {
				NOT = { has_trait = chaste }
				exists = scope:scheme_successful
			}
			add_stress = minor_stress_gain
		}
	}

	#Failure: no lovers at all please!
	option = {
		name = seduce_outcome.0003.e
		custom_tooltip = seduce_outcome.0003.e.tt
		add_character_flag = {
			flag = block_seduce_attempts
			years = 10
		}

		save_scope_value_as = {
			name = target_chose_nice_reject
			value = yes
		}
		show_as_tooltip = {
			scope:scheme = {
				end_scheme = yes
			}
		}
		scope:owner = {
			trigger_event = {
				id = seduce_outcome.4001 #Nice reject
				days = 1
			}
		}

		#Stress
		stress_impact = {
			lustful = medium_stress_impact_gain
		}
	}
}

#reject romance
acquaintance.8007 = {
	type = character_event
	title = acquaintance.8001.t
	desc = acquaintance.8001.desc

	
	theme = seduce_scheme
	left_portrait = scope:owner

	trigger = {
		exists = scope:scheme
		scope:owner = { is_alive = yes }
	}

	immediate = {
		hidden_effect = {
			#For clearer and more controllable ai outcomes, we determine the outcome here:

			#HARD REJECT
			if = { # Guaranteed rejection
				limit = { NOT = { is_attracted_to_gender_of = scope:owner  } }
				save_scope_value_as = {
					name = reject_outcome
					value = flag:reject
				}
			}
		}
	}

	option = { #Stop it!
		name = acquaintance.8001.a
		
		reverse_add_opinion = {
			target = scope:owner
			modifier = refusal_opinion
			opinion = -20
		}

		seduction_block_character_effect = { CHARACTER = scope:owner }

		scope:owner = {
			trigger_event = acquaintance.8008
		}
		
		ai_chance = {
			base = 0
			modifier = {
				add = 100
				scope:reject_outcome = flag:reject_no_reveal
			}
		}
	}
}

acquaintance.8008 = {
	type = character_event
	title = acquaintance.8008.t
	desc = acquaintance.8008.desc
	
	theme = romance_scheme
	override_background = { reference = study }
	left_portrait = {
		character = scope:owner
		animation = sadness
	}
	
	trigger = {
		exists = scope:scheme
		scope:owner = { is_alive = yes }
	}	
	widget = {
		gui = "event_window_widget_scheme"
		container = "custom_widgets_container"
	}

	option = {
		name = acquaintance.8008.a
		custom_tooltip = seduce_outcome.blocked_from_seduction

		scope:target = { seduction_block_character_effect = { CHARACTER = scope:owner } }
		if = {
			limit = { exists = scope:scheme }
			scope:scheme = {
				end_scheme = yes
			}
		}

	}
}





#new_flags for new player after death of previous#TESTED AN WORKING

acquaintance.9002 = {
	type = character_event
	hidden = yes 
	
	trigger = {
			is_ai = no
			}
		
		immediate = {
		primary_heir = {
	
		every_consort = {
				add_to_temporary_list = natural_acquaintances
		}
		every_councillor = {
				add_to_temporary_list = natural_acquaintances
		}
		every_vassal = {
				add_to_temporary_list = natural_acquaintances
		}
		every_court_position_holder = {
				add_to_temporary_list = natural_acquaintances
		}
		every_general_councillor = {
				add_to_temporary_list = natural_acquaintances
		}
		every_knight = {
				add_to_temporary_list = natural_acquaintances
		}
		liege = {
				add_to_temporary_list = natural_acquaintances
		}
		every_courtier_or_guest = {
				add_to_temporary_list = natural_acquaintances
		}
		every_prisoner = {
				add_to_temporary_list = natural_acquaintances
		}
		every_child = {
			every_spouse = {
				add_to_temporary_list = natural_acquaintances
			}
		}
		every_relation = {
		type = ward
				add_to_temporary_list = natural_acquaintances
		}
		every_relation = {
		type = guardian
				add_to_temporary_list = natural_acquaintances
		}
		every_relation = {
		type = friend
				add_to_temporary_list = natural_acquaintances
		}
		every_relation = {
		type = lover
				add_to_temporary_list = natural_acquaintances
		}
		every_relation = {
		type = nemesis
				add_to_temporary_list = natural_acquaintances
		}
		every_relation = {
		type = soulmate
				add_to_temporary_list = natural_acquaintances
		}
		every_relation = {
		type = crush
				add_to_temporary_list = natural_acquaintances
		}
		every_relation = {
		type = bully
				add_to_temporary_list = natural_acquaintances
		}
		every_relation = {
		type = soldier_friend
				add_to_temporary_list = natural_acquaintances
		}
		every_relation = {
		type = victim
				add_to_temporary_list = natural_acquaintances
		}
		every_relation = {
		type = potential_friend
				add_to_temporary_list = natural_acquaintances
		}
		every_relation = {
		type = potential_rival
				add_to_temporary_list = natural_acquaintances
		}
		every_relation = {
		type = best_friend
				add_to_temporary_list = natural_acquaintances
		}
		every_relation = {
		type = mentor
				add_to_temporary_list = natural_acquaintances
		}
		every_relation = {
		type = student
				add_to_temporary_list = natural_acquaintances
		}
		every_relation = {
		type = intrigue_mentor
				add_to_temporary_list = natural_acquaintances
		}
		every_relation = {
		type = intrigue_student
				add_to_temporary_list = natural_acquaintances
		}
		every_relation = {
		type = potential_lover
				add_to_temporary_list = natural_acquaintances
		}
		every_relation = {
		type = court_physician
				add_to_temporary_list = natural_acquaintances
		}
		every_relation = {
		type = antiquarian
				add_to_temporary_list = natural_acquaintances
		}
		every_relation = {
		type = oaf
				add_to_temporary_list = natural_acquaintances
		}
		liege = {
		every_vassal = {
				add_to_temporary_list = natural_acquaintances
		}
		}
		liege = {
		every_councillor = {
				add_to_temporary_list = natural_acquaintances
		}
		}
		}
		every_in_list = {
			limit = {
			is_alive = yes}
			list = natural_acquaintances
			character_deception_effect = yes
				character_known_effect = yes
			}
			
		}
	}

#RUMOURS#TESTED AN WORKING
acquaintance.9003 = {
	hidden = yes 
	
		trigger = {
			is_ai = no
			is_alive = yes
			}
			
	immediate = {
		every_living_character = {
			limit = {
			this.location = { squared_distance = { target = root.location value <= 120000 } }
			NOT = {this = {highest_held_title_tier >= tier_kingdom}}
			has_potential_for_not_negative_rumour_trigger = yes
			NOT = {this = root.top_liege}}
			add_to_temporary_list = heard_rumours}
	random_in_list = {
		list = heard_rumours
		save_scope_as = rumour
		}
		
		trigger_event = {
			id = acquaintance.9004
			days = 1
		}
	}
}

acquaintance.9004 = {#TESTED AN WORKING
	type = character_event
	hidden = yes 
	
		trigger = {
			exists = scope:rumour
			}
			
	immediate = {
	scope:rumour = {add_character_flag = had_rumour_spread}
	
	if = {
		limit = {scope:rumour = {
					OR = {
					AND = {
						OR = {
						has_trait = intellect_good_2
						has_trait = intellect_good_3
						has_trait = shrewd}
						sum_of_all_skills_value >= 45}
					AND = { has_trait_rank = {
					trait = education_learning
					rank > 2
							}
				sum_of_all_skills_value >= 35					
				learning >= 25}
		AND = { obf_illusory_scholar = yes
				learning >= 17}}}}
				scope:rumour = {add_character_flag = {
				flag = had_rumour_spread_intellectual
				years = 3
					}}}
	
	else_if = {
		limit = {scope:rumour = {
					OR = {
					AND = { has_trait_rank = {
					trait = education_martial
					rank > 1
							} 
				martial >= 25}
		AND = { obf_illusory_warrior = yes
				martial >= 17}}}}
				scope:rumour = {add_character_flag = {
				flag = had_rumour_spread_excellent_commander
				years = 3
					}}}
	
	
	else_if = {
		limit = {scope:rumour = {
					OR = {
					likely_pretend_brave_fighter_trigger = yes
					likely_a_brave_fighter_trigger = yes}}}
				scope:rumour = {add_character_flag = {
				flag = had_rumour_spread_excellent_knight
				years = 3
					}}}
					
	else_if = {
		limit = {scope:rumour = {
				OR = {
				has_trait = beauty_good_3
				has_trait = beauty_good_2
				has_trait = beauty_bad_3
								}}}
				scope:rumour = {add_character_flag = {
				flag = had_rumour_spread_trait
				years = 3
					}}}

		root = {
				scope:rumour = {add_character_flag = {
				flag = player_was_notified
				years = 3
					}}
				send_interface_message = {
				type = event_generic_neutral
				title = you_heard_rumours
				right_icon = root
				left_icon = scope:rumour
				custom_tooltip = rumour_about_character}}
		}	
	}

acquaintance.9006 = {#
	type = character_event
	hidden = yes 

	immediate = {
	root = {save_scope_as = rumour}
	add_character_flag = {
		flag = had_rumour_spread
		years = 10
				}
	add_character_modifier = {
		modifier = had_rumours_spread_modifier
		years = 3
				}
	every_vassal_or_below = {
			add_opinion = {
			target = root
			modifier = heard_bad_rumours_opinion
			years = 3
				}
			}
	every_courtier_or_guest = {
			add_opinion = {
			target = root
			modifier = heard_bad_rumours_opinion
			years = 3
				}
			}
	every_liege_or_above = {
			add_opinion = {
			target = root
			modifier = heard_bad_rumours_opinion
			years = 3
				}
			}
	if = {
		limit = {has_potencial_negative_rumour_to_spread = no
		has_potencial_false_negative_rumour_to_spread = no}
		add_character_flag = {
				flag = had_rumour_spread_sexual_taste
				years = 3
					}
		}
	else_if = { 
		limit = {OR = {has_potencial_negative_rumour_to_spread = yes
		has_potencial_false_negative_rumour_to_spread = yes}}
			random_list = {
			10 = {
				modifier = {
					factor = 0
					obf_likely_incest_trigger = no
				}
				modifier = {
					factor = 2.5
					any_secret = {
					secret_type = secret_incest 
							}
				}
				modifier = {
					factor = 1.5
					AND = {has_trait = seducer
					has_trait = lustful}
				}
				add_character_flag = {
				flag = had_rumour_spread_incest
				years = 3
					}
			}
			10 = {
				modifier = {
					factor = 0
					likely_hide_heritage_trigger = no
				}
				modifier = {
					factor = 2.5
					OR = {		
						any_secret = {
							secret_type = secret_unmarried_illegitimate_child 
							}
						any_secret = {
							secret_type = secret_disputed_heritage
									}}
				}
				modifier = {
					factor = 1.5
					has_personality_introverted_trigger = yes
				}
				modifier = {
					add = 1.5
					has_personality_submissive_trigger = yes
				}
				add_character_flag = {
				flag = had_rumour_spread_bastard
				years = 3
					}
			}
			
			10 = {
				modifier = {
					factor = 0
					obf_capable_of_murder_trigger = no
				}
				modifier = {
					factor = 2.5
					any_secret = {
					secret_type = secret_murder 
							}
				}
				modifier = {
					factor = 1.5
					piety_level <= 0
				}
				modifier = {
					factor = 1.5
					is_seen_as_mad_or_avoidable_trigger = yes
				}
				modifier = {
					factor = 2
					is_a_malicious_person_trigger = yes
				}
				add_character_flag = {
				flag = had_rumour_spread_murder
				years = 3
					}
			}
			10 = {
				modifier = {
					factor = 0
					OR = { obf_likely_witch_trigger = no
						likely_cynic_non_believer_trigger = no}
				}
				modifier = {
					factor = 2
					OR = {
					any_secret = {
						secret_type = secret_non_believer 
							}
					any_secret = {
						secret_type = secret_witch 
							}}
				}
				modifier = {
					factor = 2
					piety_level <= 0
				}
				modifier = {
					factor = 1.5
					is_seen_as_mad_or_avoidable_trigger = yes
				}
				modifier = {
					factor = 1.5
					has_trait = lifestyle_mystic 
				}
				modifier = {
					factor = 1.5
					has_trait = lifestyle_herbalist
				}
				modifier = {
					factor = 1.5
					has_trait = lifestyle_physician
				}
				modifier = {
					factor = 2
					has_trait = cynical
				}
				add_character_flag = {
				flag = had_rumour_spread_false_religion
				years = 3
					}
			}
			10 = {
				modifier = {
					factor = 0
					obf_likely_hide_sexuality_trigger = no
				}
				modifier = {
					add = 2.5
					OR = {			
					any_secret = {
						secret_type = secret_homosexual
							}
					any_secret = {
						secret_type = secret_deviant
								}						
							}
				}
				modifier = {
					factor = 2
					has_personality_submissive_trigger = yes
				}
				add_character_flag = {
				flag = had_rumour_spread_sexual_taste
				years = 3
					}
			}
			
			10 = {
				modifier = {
					factor = 0
					obf_likely_extramarital_affair_trigger = no
				}
				modifier = {
					add = 2.5
					any_secret = {
					secret_type = secret_lover 
							}}
				modifier = {
					add = 2
					is_a_attractive_person_trigger = yes
				}
				modifier = {
					add = 2
					has_trait = seducer
				}
				modifier = {
					add = 2
					has_trait = lustful
				}
				add_character_flag = {
				flag = had_rumour_spread_lover
				years = 3
					}
			}
			
		}
		if = {
		limit = {player_should_receive_warning = yes}
				every_player = {
				root = {add_character_flag = {
				flag = player_was_notified
				years = 3
					}}
				send_interface_message = {
				type = event_generic_neutral
				title = you_heard_rumours
				right_icon = root
				custom_tooltip = rumour_about_character}}
			}
		}
	}
}	




